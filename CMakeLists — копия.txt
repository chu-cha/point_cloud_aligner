cmake_minimum_required(VERSION 3.15)  # Qt6 требует CMake 3.15+
project(aligner)

if(WIN32)
    set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>")
endif()

set(CMAKE_PREFIX_PATH "C:/vcpkg/installed/x64-windows")

# Настройки для GLEW
set(GLEW_USE_STATIC_LIBS OFF)
find_package(GLEW REQUIRED)

# Настройки Qt6 (все изменения здесь)
set(CMAKE_AUTOMOC ON)
find_package(Qt6 REQUIRED COMPONENTS Core Widgets OpenGLWidgets)  # OpenGLWidgets вместо OpenGL

# Настройки VTK с Qt-интеграцией
set(VTK_GROUP_QT ON)
find_package(VTK REQUIRED COMPONENTS
    CommonCore
    InteractionStyle
    RenderingOpenGL2
    GUISupportQt
)

# Настройки PCL
find_package(PCL REQUIRED COMPONENTS common io visualization)

add_executable(aligner 
	main.cpp 
	main_window.cpp 
	main_window.h
	render_window.h
	render_window.cpp	)

target_link_libraries(aligner PRIVATE
    Qt6::Core 
    Qt6::Widgets
    Qt6::OpenGLWidgets 
    ${VTK_LIBRARIES}
    ${PCL_LIBRARIES}
    GLEW::GLEW
    pcl_visualization 
)

# Копирование DLL на Windows
if(WIN32)
    #file(GLOB QT6_DLLS "C:/vcpkg/installed/x64-windows/bin/Qt6*.dll")
    #file(GLOB VTK_DLLS "C:/vcpkg/installed/x64-windows/bin/vtk*.dll")
	#file(GLOB PCL_DLLS "C:/vcpkg/installed/x64-windows/bin/pcl*.dll")
	#file(GLOB BOOST_DLLS "C:/vcpkg/installed/x64-windows/bin/boost*.dll")
file(GLOB DLL_FILES 
    "C:/vcpkg/installed/x64-windows/bin/pcl_*.dll"
    "C:/vcpkg/installed/x64-windows/bin/vtk*.dll"
	"C:/vcpkg/installed/x64-windows/bin/Qt6*.dll"
	"C:/vcpkg/installed/x64-windows/bin/*.dll"
)
add_custom_command(TARGET aligner POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
    ${DLL_FILES}
    $<TARGET_FILE_DIR:aligner>
)
endif()